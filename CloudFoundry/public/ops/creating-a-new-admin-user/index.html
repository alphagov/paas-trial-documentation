<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cloud.gov documentation">
    <meta name="author" content="18f">
    <meta name="generator" content="Hugo 0.14" />

    <title>Creating an admin user</title>

    <link href="/css/bootstrap-theme.css" rel="stylesheet">
    <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/style-responsive.css" rel="stylesheet" />
    <link href="/css/monokai_sublime.css" rel="stylesheet" />

  </head>

  <body>
  
  <section id="container" class="">

      
      <header class="header black-bg">
            <div class="toggle-nav">
                <i class="fa fa-bars"></i>
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
            </div>

            
            <a href="/" title="Home">
              <h2 class="main">docs.cloud.gov</h2>
            </a>
            
            <div class="top-nav notification-row">
            </div>

            <div class="nav title-row" id="top_menu">
                <h1 class="nav top-menu">Creating an admin user</h1>
            </div>
      </header>
      


<aside>
    <div id="sidebar" class="nav-collapse">
        
        <ul class="sidebar-menu">
          
          
              

            <li class="sub-menu">
            <a href="javascript:;" class="">
                <i class='fa fa-road'></i>
                
                <span>Getting Started</span>
                <span class="menu-arrow fa fa-angle-right"></span>
            </a>
                <ul class="sub">
                    
                    <li><a href="/getting-started/setup/">Setup</a> </li>
                    
                    <li><a href="/getting-started/concepts/">Concepts</a> </li>
                    
                    <li><a href="/getting-started/cf-ssh/">Running one off tasks</a> </li>
                    
                </ul>
              
              </li>
          
              

            <li class="sub-menu">
            <a href="javascript:;" class="">
                <i class='fa fa-file-text'></i>
                
                <span>Deploying Apps</span>
                <span class="menu-arrow fa fa-angle-right"></span>
            </a>
                <ul class="sub">
                    
                    <li><a href="/apps/deployment/">General Deployment Tips</a> </li>
                    
                    <li><a href="/apps/basic-deploy-troubleshooting/">Basic Deploy Troubleshooting</a> </li>
                    
                    <li><a href="/apps/cloning/">Cloning Applications</a> </li>
                    
                    <li><a href="/apps/continuous-deployment/">Continuous Deployment</a> </li>
                    
                    <li><a href="/apps/databases/">Databases</a> </li>
                    
                    <li><a href="/apps/django/">Deploying Django</a> </li>
                    
                    <li><a href="/apps/flask/">Deploying Flask</a> </li>
                    
                    <li><a href="/apps/meteor/">Deploying Meteor</a> </li>
                    
                    <li><a href="/apps/multi-buildpack-deploys/">Deploying Multi-language Projects</a> </li>
                    
                    <li><a href="/apps/rails/">Deploying Rails</a> </li>
                    
                    <li><a href="/apps/static/">Deploying Static Sites</a> </li>
                    
                    <li><a href="/apps/node/">Deploying node.js</a> </li>
                    
                    <li><a href="/apps/durable-logging/">Durable Logging with the ELK Service</a> </li>
                    
                    <li><a href="/apps/moving-apps/">Moving apps between spaces</a> </li>
                    
                    <li><a href="/apps/production-ready/">Production Ready Checklist</a> </li>
                    
                    <li><a href="/apps/apt-get/">Using apt-get</a> </li>
                    
                </ul>
              
              </li>
          
              

            <li class="sub-menu active">
            <a href="javascript:;" class="">
                <i class='fa fa-wrench'></i>
                
                <span>Operations</span>
                <span class="menu-arrow fa fa-angle-down"></span>
            </a>
                <ul class="sub open">
                    
                    <li><a href="/ops/aws-onboarding/">AWS Onboarding</a> </li>
                    
                    <li><a href="/ops/accessing-v1-managed-services/">Accessing v1 Managed Services</a> </li>
                    
                    <li><a href="/ops/changing-password/">Changing a password</a> </li>
                    
                    <li><a href="/ops/creating-a-stemcell-building-vm/">Creating a Stemcell Building VM</a> </li>
                    
                    <li><a href="/ops/creating-a-development-environment-with-bosh-lite/">Creating a dev environment</a> </li>
                    
                    <li><a href="/ops/creating-a-local-dev-environment-in-Virtual-Box/">Creating a local dev environment with Virtual Box</a> </li>
                    
                    <li><a href="/ops/create-user/">Creating a user</a> </li>
                    
                    <li class="active"><a href="/ops/creating-a-new-admin-user/">Creating an admin user</a> </li>
                    
                    <li><a href="/ops/deploying-the-docker-broker/">Deploying the Docker Broker</a> </li>
                    
                    <li><a href="/ops/deploying-the-admin-ui/">Deploying the admin UI</a> </li>
                    
                    <li><a href="/ops/elb/">ELB termination</a> </li>
                    
                    <li><a href="/ops/repos/">Github Repos</a> </li>
                    
                    <li><a href="/ops/making-announcements/">Making announcements</a> </li>
                    
                    <li><a href="/ops/metrics/">Metrics</a> </li>
                    
                    <li><a href="/ops/plugins/">Plugins</a> </li>
                    
                    <li><a href="/ops/policies/">Policies</a> </li>
                    
                    <li><a href="/ops/ports/">Port Descriptions</a> </li>
                    
                    <li><a href="/ops/multiple-instances/">Running Multiple Instances</a> </li>
                    
                    <li><a href="/ops/updating-cf/">Updating Cloud Foundry</a> </li>
                    
                </ul>
              
              </li>
          
              
              </li>
          
              

            <li class="sub-menu">
            <a href="javascript:;" class="">
                <i class='fa fa-columns'></i>
                
                <span>Updates</span>
                <span class="menu-arrow fa fa-angle-right"></span>
            </a>
                <ul class="sub">
                    
                    <li><a href="/updates/2015-05-29/">5/29/2015</a> </li>
                    
                </ul>
              
              </li>
          
            <li> <a href="https://github.com/18f/cloud-foundry-notes/issues" target="blank"><i class='fa fa-life-ring'></i> <span>Issues & Help</span></a> </li>
            
              <li><a href="https://github.com/18f/cloud-foundry-notes/edit/master/content/ops/creating-a-new-admin-user.md" target="blank"><i class='fa fa-edit'></i> Refine this Page</a> </li>
            
        </ul>
        
    </div>
</aside>



      
      <section id="main-content">
          <section class="wrapper">

              <div class="row">
                  <div class="col-md-1">
                      
                      
                      
                  </div>
                <div class="col-md-10">
                    <section class="panel">
                      <div class="panel-body">



<p>The true &ldquo;root&rdquo; admin user is defined in the initial deployment manifest under uaa &gt; admin. We’ll use those credentials to connect to the deployed UAA instance and create delegated admin users.</p>

<h4 id="background:177d9175941a0113c71cc1b2620a07a7">Background:</h4>

<p>The <a href="https://github.com/cloudfoundry/uaa">User Account and Authentication server</a> is the identity management component of Cloud Foundry. Beyond the initial deployment manifest, all users and their permissions are defined in UAA.</p>

<h4 id="prerequisites:177d9175941a0113c71cc1b2620a07a7">Prerequisites:</h4>

<ul>
<li>Knowledge of the secrets specified in the initial deployment manifest.</li>
<li>A reachable CF UAA instance.</li>
<li>A working ruby install.</li>
</ul>

<h4 id="procedure:177d9175941a0113c71cc1b2620a07a7">Procedure:</h4>

<ol>
<li><a href="#installing-the-uaa-cli:177d9175941a0113c71cc1b2620a07a7">Installing the UAA CLI</a></li>
<li><a href="#specifying-the-uaa-target:177d9175941a0113c71cc1b2620a07a7">Specifying the UAA Target</a></li>
<li><a href="#obtaining-a-token:177d9175941a0113c71cc1b2620a07a7">Obtaining A Token</a></li>
<li><a href="#confirming-authorization:177d9175941a0113c71cc1b2620a07a7">Confirming Authorization</a></li>
<li><a href="#missing-permissions:177d9175941a0113c71cc1b2620a07a7">Missing Permissions</a></li>
<li><a href="#creating-a-new-user:177d9175941a0113c71cc1b2620a07a7">Creating A New User</a></li>
<li><a href="#adding-user-permissions:177d9175941a0113c71cc1b2620a07a7">Adding User Permissions</a></li>
<li><a href="#confirming-creation:177d9175941a0113c71cc1b2620a07a7">Confirming Creation</a></li>
<li><a href="#additional-resources:177d9175941a0113c71cc1b2620a07a7">Additional Resources</a></li>
</ol>

<h5 id="installing-the-uaa-cli:177d9175941a0113c71cc1b2620a07a7">Installing the UAA CLI:</h5>

<pre><code>gem install cf-uaac
</code></pre>

<h5 id="specifying-the-uaa-target:177d9175941a0113c71cc1b2620a07a7">Specifying the UAA Target:</h5>

<pre><code>uaac target uaa.cloud.gov
</code></pre>

<h5 id="obtaining-a-token:177d9175941a0113c71cc1b2620a07a7">Obtaining A Token:</h5>

<pre><code>uaac token client get admin
</code></pre>

<p>At the <code>Client secret:</code> prompt enter the secret specified in <code>uaa:admin:client_secret</code> in the deployment manifest.</p>

<p>Note: The client secret can specified on the command line with the <code>-s</code> switch, but it’s a good habit to avoid the possibility of leaving secrets in your shell history.</p>

<pre><code>Client secret:  ********************************

Successfully fetched token via client credentials grant.
Target: https://uaa.cloud.gov
Context: admin, from client admin
</code></pre>

<h5 id="confirming-authorization:177d9175941a0113c71cc1b2620a07a7">Confirming Authorization:</h5>

<p>Use <code>uaac context</code> to confirm your current authorization and permissions.</p>

<pre><code>[1]*[https://uaa.cloud.gov]
  skip_ssl_validation: true

  [0]*[admin]
    client_id: admin
    access token: ****
    token_type: bearer
      expires_in: ****
    scope: scim.read uaa.admin password.write scim.write clients.write clients.read clients.secret
    jti: ****
</code></pre>

<p>Note that the admin user has the scim.write permission which is required to create user accounts. If the admin account is missing this permission we’ll need to add it as described in Missing Permissions. Otherwise, jump ahead to Creating an Admin User.</p>

<h5 id="missing-permissions:177d9175941a0113c71cc1b2620a07a7">Missing Permissions:</h5>

<p>In the event that the admin user does not have the scim.write permission we can add it. First, we need to record the existing permissions of the admin account as displayed by the uaac context command above. We’ll use that space-delimited list of permissions in place of EXISTING-PERMISSIONS below.</p>

<pre><code>uaac client update admin --authorities “EXISTING-PERMISSIONS scim.write”
</code></pre>

<p>Delete the existing authorization token.</p>

<pre><code>uaac token delete
</code></pre>

<p>Obtain a new token bearing the update permissions.</p>

<pre><code>uaac token client get admin
</code></pre>

<h5 id="creating-a-new-user:177d9175941a0113c71cc1b2620a07a7">Creating A New User:</h5>

<p>Now that we have a authorization token bearing the scim.write permission in hand we can create a new user.</p>

<pre><code>uaac user add NEW-ADMIN-USERNAME --emails NEW-ADMIN-EMAIL
</code></pre>

<p>You’ll be prompted to provide an initial password.  Currently, we’re using first.last@gsa.gov as the convention for new usernames with the same for email.</p>

<p><strong>Note:</strong> The client secret can specified on the command line with the <code>-p</code> switch, but it’s a good habit to avoid the possibility of leaving secrets in your shell history.</p>

<h5 id="adding-user-permissions:177d9175941a0113c71cc1b2620a07a7">Adding User Permissions:</h5>

<p>An admin user should be part of the four groups: <code>cloud_controller.admin</code>, <code>uaa.admin</code>, <code>scim.read</code> and <code>scim.write</code>. Add each with <code>uaac member add</code>.</p>

<pre><code>uaac member add cloud_controller.admin first.last@gsa.gov
uaac member add uaa.admin first.last@gsa.gov
uaac member add scim.read first.last@gsa.gov
uaac member add scim.write first.last@gsa.gov
</code></pre>

<h5 id="confirming-creation:177d9175941a0113c71cc1b2620a07a7">Confirming Creation:</h5>

<p>We can view information about the newly created user by filtering the output of <code>uaac users</code>.</p>

<pre><code>uaac users 'username eq &quot;first.last@gsa.gov&quot;'
</code></pre>

<p><strong>Output:</strong></p>

<pre><code>resources:
  -
    id: ***
    meta
      version: 0
      created: 2015-02-25T02:10:06.566Z
      lastmodified: 2015-02-25T02:10:06.566Z
    name
    emails:
    -
      value: first.last@gsa.gov
    groups:
    -
      value: ***
      display: cloud_controller.read
      type: DIRECT

    ...lots of groups...

      value: ***
      display: oauth.approvals
      type: DIRECT
    approvals:
    active: true
    verified: false
    origin: uaa
    schemas: urn:scim:schemas:core:1.0
    username: first.last@gsa.gov
  schemas: urn:scim:schemas:core:1.0
  startindex: 1
  itemsperpage: 100
  totalresults: 1
</code></pre>

<h5 id="additional-resources:177d9175941a0113c71cc1b2620a07a7">Additional Resources:</h5>

<ul>
<li><p>For more information on filtering see the <a href="https://github.com/cloudfoundry/uaa/blob/master/docs/UAA-APIs.rst#a-note-on-filtering">UAA API docs</a>.</p></li>

<li><p>The Cloud Foundry documentation includes a comprehensive <a href="http://docs.cloudfoundry.org/adminguide/uaa-user-management.html#creating-admin-users">guide to user creation and management via cf-uaac</a>.</p></li>
</ul>

                      <hr style="margin: 2em auto 0.25em;">
                    </div>
                    </section>

                    <footer>
                      Built with <i class="fa fa-heart"></i> by the cloud.gov team | 
                      <a href="https://github.com/18F/cloud-foundry-notes/issues">
                        Send us feedback
                      </a>
                    </footer>

                </div>
                <div class="col-md-1">
                    
                    
                    
                </div>
              </div>
              
          </section>
      </section>
     
  </section>
  
    
    <script src="/js/jquery-2.1.1.min.js"></script>
    <script src="/js/jquery.scrollTo.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/scripts.js"></script>
  <script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

