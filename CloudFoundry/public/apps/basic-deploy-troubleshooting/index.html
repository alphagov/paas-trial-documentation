<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Govt PaaS documentation">
    <meta name="author" content="Brett Ansley">
    <meta name="generator" content="Hugo 0.14" />

    <title>Basic Deploy Troubleshooting</title>

    <link href="/css/bootstrap-theme.css" rel="stylesheet">
    <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/style-responsive.css" rel="stylesheet" />
    <link href="/css/monokai_sublime.css" rel="stylesheet" />

  </head>

  <body>
  
  <section id="container" class="">

      
      <header class="header black-bg">
            <div class="toggle-nav">
                <i class="fa fa-bars"></i>
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
            </div>

            
            <a href="/" title="Home">
              <h2 class="main">Govt PaaS</h2>
            </a>
            
            <div class="top-nav notification-row">
            </div>

            <div class="nav title-row" id="top_menu">
                <h1 class="nav top-menu">Basic Deploy Troubleshooting</h1>
            </div>
      </header>
      


<aside>
    <div id="sidebar" class="nav-collapse">
        
        <ul class="sidebar-menu">
          
          
              

            <li class="sub-menu">
            <a href="javascript:;" class="">
                <i class='fa fa-road'></i>
                
                <span>Getting Started</span>
                <span class="menu-arrow fa fa-angle-right"></span>
            </a>
                <ul class="sub">
                    
                    <li><a href="/getting-started/setup/">Setup</a> </li>
                    
                    <li><a href="/getting-started/bucketlist/">Things to try out</a> </li>
                    
                    <li><a href="/getting-started/concepts/">Concepts</a> </li>
                    
                    <li><a href="/getting-started/cf-ssh/">Running one off tasks</a> </li>
                    
                </ul>
              
              </li>
          
              

            <li class="sub-menu active">
            <a href="javascript:;" class="">
                <i class='fa fa-file-text'></i>
                
                <span>Deploying Apps</span>
                <span class="menu-arrow fa fa-angle-down"></span>
            </a>
                <ul class="sub open">
                    
                    <li><a href="/apps/deployment/">General Deployment Tips</a> </li>
                    
                    <li><a href="/apps/quotas/">Quotas</a> </li>
                    
                    <li><a href="/apps/sample-apps/">Sample apps</a> </li>
                    
                    <li class="active"><a href="/apps/basic-deploy-troubleshooting/">Basic Deploy Troubleshooting</a> </li>
                    
                    <li><a href="/apps/cloning/">Cloning Applications</a> </li>
                    
                    <li><a href="/apps/databases/">Databases</a> </li>
                    
                    <li><a href="/apps/django/">Deploying Django</a> </li>
                    
                    <li><a href="/apps/flask/">Deploying Flask</a> </li>
                    
                    <li><a href="/apps/static/">Deploying Static Sites</a> </li>
                    
                    <li><a href="/apps/node/">Deploying node.js</a> </li>
                    
                    <li><a href="/apps/moving-apps/">Moving apps between spaces</a> </li>
                    
                    <li><a href="/apps/apt-get/">Using apt-get</a> </li>
                    
                </ul>
              
              </li>
          
            <li> <a href="/index.html" target="blank"><i class='fa fa-life-ring'></i> <span>Issues & Help</span></a> </li>
        </ul>
        
    </div>
</aside>



      
      <section id="main-content">
          <section class="wrapper">

              <div class="row">
                  <div class="col-md-1">
                      
                      
                      
                  </div>
                <div class="col-md-10">
                    <section class="panel">
                      <div class="panel-body">



<p>The most direct way to view events related to your application through the deploy process is <code>cf logs APPNAME</code>. Used alone, <code>cf logs</code> will tail the combined stream of logs from each Cloud Foundry service involved in your application deploy. Running with the recent flag as in <code>cf logs APPNAME --recent</code> will stream the entire loggregator buffer for your app.</p>

<p><strong>API:</strong>
Calls to stop, start and update the application. Exit status of errors reported by the DEA.</p>

<p><strong>App:</strong>
Stdout and stderr of the application start command.</p>

<p><strong>DEA:</strong>
Responses to API stop, start and update calls.</p>

<p><strong>RTR:</strong>
Responses to clients requests made to the application route.</p>

<p><strong>STG:</strong>
Buildpack activity.</p>

<h5 id="log-format:3a0034a69d74a354c7c51ba0ccfcbbb0">Log Format:</h5>

<p>Each line of log output has the following format: A timestamp, the source service / instance the type of output (OUT/ERR) and finally the output detail.</p>

<pre><code>Timestamp                   Svc/Ins      Type      Detail
2015-01-01T00:00:00.00-0400 [XXX/N]      OUT/ERR   ...
</code></pre>

<p><strong>Example Log:</strong></p>

<pre><code>2015-03-16T17:37:47.82-0400 [DEA/1]      OUT Starting app instance (index 0) with guid GUID
2015-03-16T17:37:50.85-0400 [DEA/1]      ERR Instance (index 0) failed to start accepting connections
2015-03-16T17:37:53.54-0400 [API/0]      OUT App instance exited with guid GUID0 payload: {&quot;cc_partition&quot;=&gt;&quot;default&quot;, &quot;droplet&quot;=&gt;&quot;GUID0&quot;, &quot;version&quot;=&gt;&quot;GUID1&quot;, &quot;instance&quot;=&gt;&quot;GUID2&quot;, &quot;index&quot;=&gt;0, &quot;reason&quot;=&gt;&quot;CRASHED&quot;, &quot;exit_status&quot;=&gt;127, &quot;exit_description&quot;=&gt;&quot;failed to accept connections within health check timeout&quot;, &quot;crash_timestamp&quot;=&gt;1426541870}
</code></pre>

<h5 id="common-problems-and-recommended-practices:3a0034a69d74a354c7c51ba0ccfcbbb0">Common Problems and Recommended Practices:</h5>

<h6 id="stg-staging-phase:3a0034a69d74a354c7c51ba0ccfcbbb0">[STG] Staging Phase:</h6>

<p><strong>Influences:</strong></p>

<p>App dependency specification.</p>

<ul>
<li><p>Dependencies are resolved during staging. For information beyond what&rsquo;s presented in <code>cf logs</code> Use the the verbose logging option for your buildpack if availble.</p>

<p>For example, <code>cf set-env APPNAME VERBOSE true</code> enables verbose logging for the default node.js buildpack.</p></li>
</ul>

<p>App size and build complexity.</p>

<ul>
<li>Pushed application files must total less than 1GB. Use <code>.cfignore</code> to specify files which should be excluded from the push.</li>
<li>The combined size of application files and the specified buildpack must total less 1.5GB.</li>
<li>The entire compiled droplet must total less than 4GB.</li>
<li>Staging must complete with 15 minutes and application must start within 5 minutes by default.</li>
</ul>

<p>Buildpacks used.</p>

<ul>
<li>Cloud Foundry will attempt to detect the buildpack to use with your app by examining the application files in search Use the <code>buildpack:</code> key in your manifest to specify a native buildpack by name or a custom buildpack by providing a URL. Override the buildpack setting and detection with the <code>-b</code> commandline switch which takes the same arguments.</li>
</ul>

<h6 id="dea-droplet-execution-phase:3a0034a69d74a354c7c51ba0ccfcbbb0">[DEA] Droplet Execution Phase:</h6>

<p><strong>Influences:</strong></p>

<p>App manifest contents.</p>

<ul>
<li>When starting multiple apps via a single manifest tree apps will start in the order they are encountered. Ensure worker apps running queues or migrations start before the apps which depend on them.</li>
</ul>

<p>Command line options to cf push.</p>

<ul>
<li><p>By default, an application will start with a command specified by its buildpack. The <code>command:</code> in an application manifest will override the buildpack start command. The <code>-c</code> switch used with <code>cf push</code> overrides both the buildpack and manifest start commands.</p>

<p>Application start commands are cached during staging. Specifying a start command via <code>-c</code> does not update the staged command. Check the staged command with <code>cf files APPNAME app_staging.yml</code>. Specifying <code>-c 'null'</code> forces the buildpack start command to be used.</p></li>
</ul>

<p>Environment variables and service bindings.</p>

<ul>
<li>Apps must listen on the port specified in the <code>VCAP_APP_PORT</code> environment variable.</li>
<li>Environment variables are updated when the app is staged and persist between application restarts. Be sure to run <code>cf restage</code> after updating a variable.</li>
<li>Specify services in the application manifest via the <code>application:key</code>, bindings will be created when the application is pushed. Avoid creating creating bindings after the fact with <code>cf bind-service</code> as that will create a hidden dependency</li>
<li>Service instance credentials and connection parameters are stored the JSON formatted <code>VCAP_SERVICES</code>. The format of this variable differs between v1 and v2 services, see <a href="http://docs.cloudfoundry.org/devguide/deploy-apps/environment-variable.html#VCAP-SERVICES">this section</a> of the Cloud Foundry docs for more information.</li>
<li>Inspect the entire application environment including <code>VCAP_SERVICES</code> with <code>cf env APPNAME</code>.</li>
</ul>

<p>Application start up time.</p>

<ul>
<li><p>By default, applications must start with 60 seconds. This timeout can be extend to a maximum of 180 second via the <code>-t</code> command line switch or <code>timeout:</code> manifest key.</p>

<p>Avoid placing long running or multi-step tasks in the application start command. Consider using worker apps as part of a multi-application manifest instead.</p></li>
</ul>

                      <hr style="margin: 2em auto 0.25em;">
                    </div>
                    </section>

                    <footer>
                      Built by the Government PaaS team | 
                      <a href="mailto:support@governmentpaas.zendesk.com">
                        Send us feedback
                      </a>
                    </footer>

                </div>
                <div class="col-md-1">
                    
                    
                    
                </div>
              </div>
              
          </section>
      </section>
     
  </section>
  
    
    <script src="/js/jquery-2.1.1.min.js"></script>
    <script src="/js/jquery.scrollTo.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/scripts.js"></script>
  </body>
</html>

