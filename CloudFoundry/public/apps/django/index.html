<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Govt PaaS documentation">
    <meta name="author" content="Brett Ansley">
    <meta name="generator" content="Hugo 0.14" />

    <title>Deploying Django</title>

    <link href="/css/bootstrap-theme.css" rel="stylesheet">
    <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/style-responsive.css" rel="stylesheet" />
    <link href="/css/monokai_sublime.css" rel="stylesheet" />

  </head>

  <body>
  
  <section id="container" class="">

      
      <header class="header black-bg">
            <div class="toggle-nav">
                <i class="fa fa-bars"></i>
                <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
            </div>

            
            <a href="/" title="Home">
              <h2 class="main">Govt PaaS</h2>
            </a>
            
            <div class="top-nav notification-row">
            </div>

            <div class="nav title-row" id="top_menu">
                <h1 class="nav top-menu">Deploying Django</h1>
            </div>
      </header>
      


<aside>
    <div id="sidebar" class="nav-collapse">
        
        <ul class="sidebar-menu">
          
          
              

            <li class="sub-menu">
            <a href="javascript:;" class="">
                <i class='fa fa-road'></i>
                
                <span>Getting Started</span>
                <span class="menu-arrow fa fa-angle-right"></span>
            </a>
                <ul class="sub">
                    
                    <li><a href="/getting-started/setup/">Setup</a> </li>
                    
                    <li><a href="/getting-started/concepts/">Concepts</a> </li>
                    
                    <li><a href="/getting-started/cf-ssh/">Running one off tasks</a> </li>
                    
                </ul>
              
              </li>
          
              

            <li class="sub-menu active">
            <a href="javascript:;" class="">
                <i class='fa fa-file-text'></i>
                
                <span>Deploying Apps</span>
                <span class="menu-arrow fa fa-angle-down"></span>
            </a>
                <ul class="sub open">
                    
                    <li><a href="/apps/deployment/">General Deployment Tips</a> </li>
                    
                    <li><a href="/apps/quotas/">Quotas</a> </li>
                    
                    <li><a href="/apps/sample-apps/">Sample apps</a> </li>
                    
                    <li><a href="/apps/basic-deploy-troubleshooting/">Basic Deploy Troubleshooting</a> </li>
                    
                    <li><a href="/apps/cloning/">Cloning Applications</a> </li>
                    
                    <li><a href="/apps/continuous-deployment/">Continuous Deployment</a> </li>
                    
                    <li><a href="/apps/databases/">Databases</a> </li>
                    
                    <li class="active"><a href="/apps/django/">Deploying Django</a> </li>
                    
                    <li><a href="/apps/flask/">Deploying Flask</a> </li>
                    
                    <li><a href="/apps/multi-buildpack-deploys/">Deploying Multi-language Projects</a> </li>
                    
                    <li><a href="/apps/static/">Deploying Static Sites</a> </li>
                    
                    <li><a href="/apps/node/">Deploying node.js</a> </li>
                    
                    <li><a href="/apps/moving-apps/">Moving apps between spaces</a> </li>
                    
                    <li><a href="/apps/apt-get/">Using apt-get</a> </li>
                    
                </ul>
              
              </li>
          
            <li> <a href="mailto:support@governmentpaas.zendesk.com" target="blank"><i class='fa fa-life-ring'></i> <span>Issues & Help</span></a> </li>
        </ul>
        
    </div>
</aside>



      
      <section id="main-content">
          <section class="wrapper">

              <div class="row">
                  <div class="col-md-1">
                      
                      
                      
                  </div>
                <div class="col-md-10">
                    <section class="panel">
                      <div class="panel-body">



<h2 id="creating-the-app:b11fc00eb39746fdffafa1227b594e02">Creating the App</h2>

<p>There&rsquo;s no explicit command to create an app, but:</p>

<pre><code class="language-bash">cf push APPNAME
</code></pre>

<p>will create or deploy the app APPNAME. But before you deploy, let&rsquo;s set up a few things.</p>

<h3 id="ignoring-files:b11fc00eb39746fdffafa1227b594e02">Ignoring files</h3>

<ol>
<li>Add <code>*.pyc</code> and <code>local_settings.py</code> to your <code>.gitignore</code>.</li>
<li><a href="/apps/deployment/#excluding-files:98159bafc57a07057ca8a36ea636fe50">Exclude your <code>.gitignore</code>d files from Cloud Foundry.</a></li>
</ol>

<h3 id="the-python-runtime:b11fc00eb39746fdffafa1227b594e02">The Python runtime</h3>

<p>Next, you want to tell Cloud Foundry which Python runtime to use. To do this, create a <code>runtime.txt</code> file, and put the full version of Python you want to deploy with in it. For instance,</p>

<pre><code>python-3.4.1
</code></pre>

<h3 id="requirements-txt:b11fc00eb39746fdffafa1227b594e02"><code>requirements.txt</code></h3>

<p>There are a couple of packages used for the deploy that will be helpful. You&rsquo;ll want to add them to the <code>requirements.txt</code> for your project.</p>

<p>Below are the lines I added to my <code>requirements.txt</code> file. Later versions will probably work but haven&rsquo;t been tested.</p>

<pre><code>whitenoise==1.0.6  #manages static assets
dj-database-url==0.3.0 #grabs environment variables and dumps them into a Django settings file
waitress==0.8.9 #a pure python WSGI server that is a replacement for gunicorn
</code></pre>

<h3 id="the-wsgi-py-file:b11fc00eb39746fdffafa1227b594e02">The <code>wsgi.py</code> file</h3>

<p>When you create a Django project, a default <code>wsgi.py</code> file should be created for you. It usually looks like this:</p>

<pre><code class="language-python">&quot;&quot;&quot;
WSGI config for PROJECTNAME project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/1.7/howto/deployment/wsgi/
&quot;&quot;&quot;

import os
os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;PROJECTNAME.settings&quot;)

from django.core.wsgi import get_wsgi_application
application = get_wsgi_application()
</code></pre>

<p>You&rsquo;ll need to add a few lines to import the <code>whitenoise</code> package and wrap the middleware around the wsgi application. This file will be used to start the wsgi server in your app. Instead of the above example, your wsgi.py should look like this:</p>

<pre><code class="language-python">&quot;&quot;&quot;
WSGI config for PROJECTNAME project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/1.7/howto/deployment/wsgi/
&quot;&quot;&quot;

import os
from django.core.wsgi import get_wsgi_application

os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;PROJECTNAME.settings&quot;)
# important that the whitenoise import is after the line above
from whitenoise.django import DjangoWhiteNoise

application = get_wsgi_application()
application = DjangoWhiteNoise(application)
</code></pre>

<p>The order here is important. The <code>DJANGO_SETTINGS_MODULE</code> environment variable must be set before importing <code>DjangoWhiteNoise</code>.</p>

<h3 id="the-procfile:b11fc00eb39746fdffafa1227b594e02">The Procfile</h3>

<p>The Procfile contains commands that Cloud Foundry will run to keep your site up. For just the Django site, create a file called <code>Procfile</code> and in it put</p>

<pre><code>web: waitress-serve --port=$VCAP_APP_PORT APPNAME.wsgi:application
</code></pre>

<p><code>APPNAME.wsgi</code> should be replaced with whatever the name of your project wsgi module is.</p>

<h3 id="the-manifest-yml:b11fc00eb39746fdffafa1227b594e02">The <code>manifest.yml</code></h3>

<p>The <a href="http://docs.cloudfoundry.org/devguide/deploy-apps/manifest.html">manifest file</a> tells <code>cf push</code> what to do with your app. Here&rsquo;s an example:</p>

<pre><code class="language-yaml">---
# all applications use these settings and services
memory: 512M
instances: 1
applications:
- name: APPNAME
  path: .
  timeout: 180
</code></pre>

<p>As you can see, it specifies the number of instances, the memory allocated to the application, and the application itself.</p>

<h3 id="create-the-app:b11fc00eb39746fdffafa1227b594e02">Create the App</h3>

<p>To create and deploy your app:</p>

<pre><code class="language-bash">cf push APPNAME --no-start
</code></pre>

<p>Normally, you would be able to view the site at <code>APPNAME.trial.cf.paas.alphagov.co.uk</code>, but we gave the command the <code>--no-start</code> flag. Before we start the app we need to set up the database.</p>

<h2 id="setting-up-the-database:b11fc00eb39746fdffafa1227b594e02">Setting Up the Database</h2>

<p><strong>First, read <a href="/apps/databases/">the database guide</a>.</strong> If you are using RDS, you&rsquo;ll need to change your <code>settings.py</code> and set one environment variable to get the database up and connect. In your <code>settings.py</code> make sure you import the package we added to the <code>requirements.txt</code> file above:</p>

<pre><code class="language-python">import dj_database_url
</code></pre>

<p>Then, you&rsquo;ll need to add a <code>DATABASES</code> setting like normal. I recommend adding this to the <code>settings.py</code> file so that your <code>local_settings.py</code> file will override the settings when you&rsquo;re working locally.</p>

<pre><code class="language-python">DATABASES = {}
DATABASES['default'] =  dj_database_url.config()
</code></pre>

<h3 id="running-the-app:b11fc00eb39746fdffafa1227b594e02">Running the app</h3>

<p>Now try running the push command without the <code>--no-start</code> flag:</p>

<pre><code class="language-bash">cf push APPNAME
</code></pre>

<p>It should now be running at <code>APPNAME.trial.cf.paas.alphagov.co.uk</code>!</p>

                      <hr style="margin: 2em auto 0.25em;">
                    </div>
                    </section>

                    <footer>
                      Built by the Government PaaS team | 
                      <a href="mailto:support@governmentpaas.zendesk.com">
                        Send us feedback
                      </a>
                    </footer>

                </div>
                <div class="col-md-1">
                    
                    
                    
                </div>
              </div>
              
          </section>
      </section>
     
  </section>
  
    
    <script src="/js/jquery-2.1.1.min.js"></script>
    <script src="/js/jquery.scrollTo.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/scripts.js"></script>
  <script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

